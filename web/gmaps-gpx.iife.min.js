var GmapsGpx=(()=>{var d=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var F=Object.getOwnPropertyNames;var R=Object.prototype.hasOwnProperty;var C=(t,e)=>{for(var a in e)d(t,a,{get:e[a],enumerable:!0})},P=(t,e,a,n)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of F(e))!R.call(t,o)&&o!==a&&d(t,o,{get:()=>e[o],enumerable:!(n=y(e,o))||n.enumerable});return t};var D=t=>P(d({},"__esModule",{value:!0}),t);var N={};C(N,{convertToGpx:()=>G,expandUrl:()=>x,generateGpx:()=>$,generateOutputFilename:()=>f,getTimestamp:()=>h,parseGoogleMapsUrl:()=>w,slugify:()=>u});function u(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}function h(){let t=new Date,e=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0"),o=String(t.getHours()).padStart(2,"0"),c=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${e}${a}${n}-${o}${c}${s}`}function f(t){let e=h();return t?`${u(t)}-${e}.gpx`:`route-${e}.gpx`}async function x(t){return(await fetch(t,{method:"HEAD",redirect:"follow"})).url}function w(t){let e=[],a="Google Maps Route",n=[],o=new URL(t),c=t.match(/\/maps\/dir\/([^@]+)/);if(c){let p=c[1].split("/").filter(i=>i.trim()!=="");for(let i of p){let r=i.match(/^(-?\d+\.?\d*),(-?\d+\.?\d*)$/);r?e.push({lat:parseFloat(r[1]),lng:parseFloat(r[2])}):n.push(decodeURIComponent(i.replace(/\+/g," ")))}}let s=o.searchParams.get("data");if(!s){let g=t.match(/\/data=([^?]+)/);g&&(s=decodeURIComponent(g[1]))}if(s){let g=/!1d(-?\d+\.?\d*)!2d(-?\d+\.?\d*)/g,p,i=[];for(;(p=g.exec(s))!==null;)i.push({lat:parseFloat(p[2]),lng:parseFloat(p[1])});if(i.length>0){e.length=0;for(let r=0;r<i.length;r++){let S=r<n.length?n[r]:r===0?"Start":r===i.length-1?"End":`Via ${r}`;e.push({lat:i[r].lat,lng:i[r].lng,name:S})}}}let m=t.match(/@(-?\d+\.?\d*),(-?\d+\.?\d*)/);m&&e.length===0&&e.push({lat:parseFloat(m[1]),lng:parseFloat(m[2])});let l=e.filter(g=>g.lat!==0||g.lng!==0);if(l.length===0)throw new Error("Could not extract coordinates from the Google Maps URL. The URL format may not be supported or the route data is not accessible.");if(n.length>=2)a=`${n[0]} to ${n[n.length-1]}`;else if(l.length>=2){let g=l[0].name||"Start",p=l[l.length-1].name||"End";a=`${g} to ${p}`}return{waypoints:l,routeName:a}}function $(t,e){let{waypoints:a}=t,n=e||t.routeName,o=s=>s.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"),c=`<?xml version="1.0" encoding="UTF-8"?>
<gpx version="1.1" creator="gmaps-gpx"
  xmlns="http://www.topografix.com/GPX/1/1"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd">
  <trk>
    <name>${o(n)}</name>
    <trkseg>
`;return a.forEach((s,m)=>{let l=s.name||`Waypoint ${m+1}`;c+=`      <trkpt lat="${s.lat}" lon="${s.lng}">
        <name>${o(l)}</name>
      </trkpt>
`}),c+=`    </trkseg>
  </trk>
</gpx>
`,c}async function G(t,e={}){let a=t;(t.includes("goo.gl")||t.includes("maps.app.goo.gl"))&&(a=await x(t));let n=w(a),o=$(n,e.routeName),c=f(e.routeName||n.routeName);return{gpx:o,routeData:n,suggestedFilename:c}}return D(N);})();
